nixfiles
========

My [NixOS][] configuration and assorted other crap, powered by
[flakes][].  Clone to `/etc/nixos`.

See [the memo][] for machine-specific notes.

[NixOS]: https://nixos.org
[flakes]: https://nixos.wiki/wiki/Flakes
[the memo]: https://memo.barrucadu.co.uk/machines.html


Backups
-------

Backups are generated by `modules.backupScripts` and uploaded to S3
with Duplicity.

Check the status of a backup collection with:

```
./backups.sh                   # for the current host
./backups.sh status            # for the current host
./backups.sh status <hostname> # for another host
```

Restore a backup to `~/tmp/backup-restore` with:

```
./backups.sh restore            # for the current host
./backups.sh restore <hostname> # for another host
```

Change the restore target by setting `$RESTORE_DIR`.


Secrets
-------

Secrets are managed with [sops-nix][].  Create / edit secrets with:

```
./sops.sh                   # secrets.yaml for current host
./sops.sh <hostname>        # secrets.yaml for <hostname>
./sops.sh <hostname> <name> # <name>.yaml for <hostname>
```

[sops-nix]: https://github.com/Mic92/sops-nix
